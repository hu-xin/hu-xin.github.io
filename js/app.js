"use strict";var http=angular.module("douban.services.http",[]);http.service("HttpService",["$window","$document",function(t,e){this.jsonp=function(a,n,o){var i="json_cb"+Math.random().toString().replace(".","");t[i]=function(t){o(t),e[0].body.removeChild(c)};var l=-1==a.indexOf("?")?"?":"";for(var r in n)l+=r+"="+n[r]+"&";l+="callback="+i;var c=e[0].createElement("script");c.src=a+l,e[0].body.appendChild(c)}}]);var douban=angular.module("douban",["ngRoute","douban.movie_list","douban.details","douban.search","douban.us_box","douban.slider"]);douban.config(["$routeProvider",function(t){t.when("/index",{templateUrl:"/views/index/view.html",controller:"sliderController"}).when("/search",{templateUrl:"/views/search/view.html",controller:"searchController"}).when("/about",{templateUrl:"/views/about/view.html"}).when("/us_box",{templateUrl:"/views/us_box/view.html",controller:"usBoxController"}).when("/details/:id",{templateUrl:"/views/details/view.html",controller:"detailsController"}).when("/:category/:page",{templateUrl:"/views/movie_list/view.html",controller:"movieListController"}).otherwise({redirectTo:"/index"})}]),douban.controller("doubanController",["$scope","$location",function(t,e){t.$local=e,t.$watch("$local.path()",function(e,a){"/about"==e?t.path="about":"/search"==e||e.startsWith("/details")&&"/search"==a?t.path="search":t.path="index"})}]);var page=angular.module("douban.services.pagination",[]);page.service("Pagination",["$compile","$document",function(t,e){this.pagination=function(a,n,o,i){var l=a-Math.floor(o/2),r=(l=(l=a>=n-Math.floor(o/2)?n-2*Math.floor(o/2):l)<1?1:l)+o;r=r>n?n+1:r;var c="";1==a?(c+='<li class="disabled">首页</li>',c+='<li class="disabled"><i class="fa fa-arrow-left"></i></li>'):(c+='<li ng-click="currentPage=1">首页</li>',c+='<li ng-click="currentPage=currentPage-1"><i class="fa fa-arrow-left"></i></li>');for(var s=l;s<r;s++)c+=s==a?'<li class="current" ng-click="getpage($event)">'+s+"</li>":'<li ng-click="getpage($event)">'+s+"</li>";a==n?(c+='<li class="disabled"><i class="fa fa-arrow-right"></i></li>',c+='<li class="disabled">末页</li>'):(c+='<li ng-click="currentPage=currentPage+1"><i class="fa fa-arrow-right"></i></li>',c+='<li ng-click="currentPage=total">末页</li>');var u=t(c)(i),d=e[0].getElementById("pagination");d.innerHTML="";for(s=0;s<u.length;s++)d.appendChild(u[s])}}]),angular.module("douban.details",["douban.services.http"]).controller("detailsController",["$scope","HttpService","$location",function(t,e,a){t.loading=!0,t.title="加载中";var n=a.$$url.replace("/details/","");e.jsonp("http://api.douban.com/v2/movie/subject/"+n,{},function(e){t.data=e,t.title=e.title,t.bgImage=e.images.large,t.fixedbg={"background-image":"url("+t.bgImage+")"},t.loading=!1,t.$apply()}),t.back=function(){history.back()}}]),angular.module("douban.slider",[]).controller("sliderController",["$scope","$interval",function(t,e){function a(){i.style.transition="all .5s",i.style.webkitTransition="all .5s"}function n(){i.style.transition=null,i.style.webkitTransition=null}function o(){r++,a(),i.style.left=100*-r+"%";for(var t=0;t<l.length;t++)l[t].classList.remove("active");r>0&&r<7?l[r-1].classList.add("active"):r>=7?l[0].classList.add("active"):l[5].classList.add("active")}var i=document.getElementsByClassName("banner-img")[0],l=document.getElementsByClassName("focus-btn")[0].children,r=1,c=i.offsetWidth,s=null;s=e(o,2e3),i.addEventListener("transitionend",function(){r>=6?(n(),i.style.left=0,r=0):r<=0&&(n(),i.style.left=700*-r+"%",r=6)},!1);var u=document.getElementsByClassName("banner")[0],d=0,g=0,p=0;u.addEventListener("touchstart",function(t){e.cancel(s),n(),d=t.touches[0].clientX}),u.addEventListener("touchmove",function(t){g=t.touches[0].clientX,p=g-d,i.style.left=-r*c/8+p+"px"}),u.addEventListener("touchend",function(t){p<c/10*.33333&&p>-c/10*.33333?(a(),i.style.left=100*-r+"%"):p>0?(r-=2,o()):o(),s=e(o,2e3)})}]),angular.module("douban.movie_list",["ngRoute","douban.services.http","douban.services.pagination"]).controller("movieListController",["$scope","$route","$routeParams","HttpService","Pagination",function(t,e,a,n,o){t.loading=!0,t.title="加载中",t.total=0,t.currentPage=parseInt(a.page);var i=10*(t.currentPage-1);n.jsonp("http://api.douban.com/v2/movie/"+a.category,{count:10,start:i},function(e){t.data=e,t.title=e.title,t.total=Math.ceil(e.total/10),o.pagination(t.currentPage,t.total,5,t),t.loading=!1,t.$apply()}),t.$watch("currentPage",function(a,n){e.updateParams({page:t.currentPage})}),t.getpage=function(e){t.currentPage=parseInt(e.target.innerHTML)},t.back=function(){history.back()}}]),angular.module("douban.search",["douban.services.http","douban.services.pagination"]).controller("searchController",["$scope","HttpService","$timeout","Pagination",function(t,e,a,n){var o=this;t.searchText="",t.total=0,t.currentPage=1;var i=10*(t.currentPage-1);t.search=function(a){t.loading=!0,o.stopPropagation&&a.stopPropagation(),e.jsonp("http://api.douban.com/v2/movie/search",{q:"{"+t.searchText+"}",count:10,start:i},function(e){t.data=e,t.total=Math.ceil(e.total/10),n.pagination(t.currentPage,t.total,5,t),t.loading=!1,t.$apply()})},t.$watch("currentPage",function(a,o){a!==o&&(i=10*(t.currentPage-1),e.jsonp("http://api.douban.com/v2/movie/search",{q:"{"+t.searchText+"}",count:10,start:i},function(e){t.data=e,t.total=Math.ceil(e.total/10),n.pagination(t.currentPage,t.total,5,t),t.loading=!1,t.$apply()}))}),t.getpage=function(e){t.currentPage=parseInt(e.target.innerHTML)},t.showbtn=!1,t.show=function(){a(function(){t.showbtn=!0},25)},t.hide=function(){a(function(){t.showbtn=!1},25)}}]),angular.module("douban.us_box",["douban.services.http"]).controller("usBoxController",["$scope","HttpService",function(t,e){t.loading=!0,t.title="加载中",e.jsonp("http://api.douban.com/v2/movie/us_box",{},function(e){t.data=e,t.title=e.title,t.loading=!1,t.$apply()}),t.back=function(){history.back()}}]);